(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(e){if(e.ep)return;e.ep=!0;const n=t(e);fetch(e.href,n)}})();function _(o,c="pad"){let t=[],s=0;const e={pageNum:0,pageSize:20};function n(l){c=="pad"?t.push(...l):t.unshift(...l)}function i(l){t=[],t=l}function h(){t=[],e.pageNum=0,f()}async function f(){e.pageNum+=1,o.bind(this,e)().then(p=>{e.pageNum==1&&(s=p.total),e.pageNum!=1?n(p.rows):i(p.rows)})}async function r(){await f()}return{list:t,total:s,loadMore:r,reload:h}}function $(o){const{url:c,responseType:t,totalSize:s}=o;return new Promise(e=>{const n=document.getElementById("progress"),i=new XMLHttpRequest;i.responseType=t,i.addEventListener("readystatechange",()=>{i.readyState===i.DONE&&(n.style.display="none",e(i.response))}),i.addEventListener("progress",h=>{const f=document.getElementById("progress");f.style.display="block",f.setAttribute("max",s),f.setAttribute("value",h.loaded)}),i.open("get",c),i.send()})}let z=`https://unpkg.com/cl-lite@${document.title}/`;async function S(o,c){return new Promise((t,s)=>{window[o]?t(window[o]):$({url:`${z}db/${o}.sqlite`,responseType:"arraybuffer",totalSize:c}).then(e=>{const n=()=>{window.SQL?(window[o]=new SQL.Database(new Uint8Array(e)),t(window[o])):setTimeout(()=>{n()},100)};n()})})}let D=`https://unpkg.com/cl-lite@${document.title}/`;const I=50049,P=654690;$({url:`${D}dist/sql-wasm.js`,responseType:"text",totalSize:I}).then(o=>{const c=document.createElement("script");c.innerHTML=o,document.head.appendChild(c),$({url:`${D}dist/sql-wasm.wasm`,responseType:"blob",totalSize:P}).then(t=>{initSqlJs({locateFile:()=>URL.createObjectURL(t)}).then(s=>{window.SQL=s})})});let C;window.addEventListener("load",async function(){location.hash||(location.hash="/home"),await R()});window.addEventListener("hashchange",async function(){await R()});async function R(){const o=window.location.hash,c=o.includes("?")?o.split("?")[0]:o,t=new URLSearchParams(o.split("?")[1]),s=t.get("fid"),e=t.get("count");document.querySelectorAll("section").forEach(r=>{r.style.display=`#/${r.getAttribute("id")}`==c?"block":"none"});const i=document.getElementById("header"),{loadMore:h}=_(f);async function f(){const[r]=arguments,l=[],p=document.createDocumentFragment();return new Promise((b,T)=>{window[`cl-category-${s}`].exec(`SELECT * FROM t_topic tp WHERE url like '%/' || ${s} || '/%' AND post_time NOTNULL ORDER BY post_time DESC LIMIT ${r.pageSize} OFFSET ${(r.pageNum-1)*r.pageSize}`)[0].values.forEach(E=>{const[m,w,O]=E,y=new Date(+`${O}000`),L=`${y.toLocaleDateString()} ${y.toLocaleTimeString()}`;l.push({text:m,url:w,date:L});const u=document.createElement("div");u.style="display: flex; align-items: center; justify-content: space-between;margin-bottom: 20px;",u.onclick=()=>{location.hash=`/detail?date=${L}&title=${m}&url=${w}`};const a=document.createElement("span");a.style="display:flex; flex-direction: column; font-size: 14px;";const d=document.createElement("span");d.style="font-size: 14px;",d.innerText=m;const x=document.createElement("span");x.style="font-size: 12px;margin-top: 6px; color: #999;",x.innerText=L,a.appendChild(d),a.appendChild(x);const M=document.createElement("span");M.style="display: flex; align-items: center; justify-content: center; font-size: 20px; color: #999;min-width: 16px;",M.innerText="›",u.appendChild(a),u.appendChild(M),p.appendChild(u)}),document.getElementById("list").appendChild(p),b({rows:l,total:e})})}switch(c){case"#/home":window.removeEventListener("scroll",()=>r(h)),i.innerText="cl-lite",S("cl-main",8192).then(g=>{const E=g.exec("SELECT tc.name, tc.fid, tc.count FROM t_channel tc"),m=document.createDocumentFragment();E[0].values.forEach(O=>{const[y,L,u]=O,a=document.createElement("div");a.onclick=()=>{location.hash=`/list?fid=${L}&title=${y}&total=${u}`};const d=document.createElement("span"),x=document.createElement("span"),M=document.createElement("span");a.style="display: flex; align-items: center; line-height: 22px; position: relative; margin-bottom: 20px;",d.style="letter-spacing: 2px;font-size: 16px;",d.innerText=y,x.style="font-size: 14px;margin-left: 3px;",x.innerText=u,M.style="font-size: 20px; color: #999; position: absolute; right: 0px;",M.innerText="›",a.appendChild(d),a.appendChild(x),a.appendChild(M),m.appendChild(a)});const w=document.getElementById("home");for(;w.firstChild;)w.firstChild.remove();w.appendChild(m)});break;case"#/list":let r=function(g){window.scrollY+window.innerHeight>=document.getElementById("list")?.scrollHeight-20&&g()};window.addEventListener("scroll",()=>r(h)),i.innerText=t.get("title"),C!=s&&(C=s,document.getElementById("list").innerHTML="",S("cl-main",8192).then(g=>{const E=g.exec(`SELECT tc.category_size FROM t_channel tc WHERE fid = ${s}`);S(`cl-category-${s}`,E[0].values[0][0]).then(m=>{h()})}));break;case"#/detail":window.removeEventListener("scroll",()=>r(h));const l=document.getElementById("detail");l.innerHTML="";const p=new URLSearchParams(o.split("?")[1]),b=p.get("title");i.innerText=b;const T=p.get("url"),v=p.get("date");S("cl-main",8192).then(g=>{const E=g.exec(`SELECT tc.detail_size FROM t_channel tc WHERE fid = ${T.split("/")[2]}`);S(`cl-detail-${T.split("/")[2]}`,E[0].values[0][0]).then(m=>{m.exec(`SELECT content FROM t_content tc WHERE url="${T}"`)[0].values.forEach(O=>{const y=`<h3>${b}</h3><span>${v}</span><br><br>${O[0]}`;l.innerHTML=y;const L=/[0-9a-fA-F]{40}/,u="magnet:?xt=urn:btih:",a=y.match(L);if(a&&a[0]){const d=document.createElement("button");d.innerText="复制磁链",d.onclick=()=>{navigator.clipboard.writeText(`${u}${matched[0]}`)},l.appendChild(d)}})})});break}}
