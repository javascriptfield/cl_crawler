(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(e){if(e.ep)return;e.ep=!0;const n=t(e);fetch(e.href,n)}})();function I(o,c="pad"){let t=[],s=0;const e={pageNum:0,pageSize:20};function n(f){c=="pad"?t.push(...f):t.unshift(...f)}function i(f){t=[],t=f}function b(){t=[],e.pageNum=0,l()}async function l(){e.pageNum+=1,o.bind(this,e)().then(r=>{e.pageNum==1&&(s=r.total),e.pageNum!=1?n(r.rows):i(r.rows)})}async function D(){await l()}return{list:t,total:s,loadMore:D,reload:b}}function v(o){const{url:c,responseType:t,totalSize:s}=o;return new Promise(e=>{const n=document.getElementById("progress"),i=new XMLHttpRequest;i.responseType=t,i.addEventListener("readystatechange",()=>{i.readyState===i.DONE&&(n.style.display="none",e(i.response))}),i.addEventListener("progress",b=>{const l=document.getElementById("progress");l.style.display="block",l.setAttribute("max",s),l.setAttribute("value",b.loaded)}),i.open("get",c),i.send()})}let P=`https://unpkg.com/cl-lite@${document.title}/`;async function S(o,c){return new Promise((t,s)=>{window[o]?t(window[o]):v({url:`${P}db/${o}.sqlite`,responseType:"arraybuffer",totalSize:c}).then(e=>{const n=()=>{window.SQL?(window[o]=new SQL.Database(new Uint8Array(e)),t(window[o])):setTimeout(()=>{n()},100)};n()})})}let R=`https://unpkg.com/cl-lite@${document.title}/`;const F=50049,A=654690;v({url:`${R}dist/sql-wasm.js`,responseType:"text",totalSize:F}).then(o=>{const c=document.createElement("script");c.innerHTML=o,document.head.appendChild(c),v({url:`${R}dist/sql-wasm.wasm`,responseType:"blob",totalSize:A}).then(t=>{initSqlJs({locateFile:()=>URL.createObjectURL(t)}).then(s=>{window.SQL=s})})});let _;window.addEventListener("load",async function(){location.hash||(location.hash="/home"),await z()});window.addEventListener("hashchange",async function(){await z()});async function z(){const o=window.location.hash,c=o.includes("?")?o.split("?")[0]:o,t=new URLSearchParams(o.split("?")[1]),s=t.get("fid"),e=t.get("count");document.querySelectorAll("section").forEach(r=>{r.style.display=`#/${r.getAttribute("id")}`==c?"block":"none"});const i=document.getElementById("header"),{list:b,loadMore:l,reload:D}=I(f);async function f(){const[r]=arguments,x=[],M=document.createDocumentFragment();return new Promise((T,$)=>{window[`cl-category-${s}`].exec(`SELECT * FROM t_topic tp WHERE url like '%/' || ${s} || '/%' AND post_time NOTNULL ORDER BY post_time DESC LIMIT ${r.pageSize} OFFSET ${(r.pageNum-1)*r.pageSize}`)[0].values.forEach(g=>{const[u,y,O]=g,h=new Date(+`${O}000`),E=`${h.toLocaleDateString()} ${h.toLocaleTimeString()}`;x.push({text:u,url:y,date:E});const p=document.createElement("div");p.style="display: flex; align-items: center; justify-content: space-between;margin-bottom: 20px;",p.onclick=()=>{location.hash=`/detail?date=${E}&title=${u}&url=${y}`};const a=document.createElement("span");a.style="display:flex; flex-direction: column; font-size: 14px;";const d=document.createElement("span");d.style="font-size: 14px;",d.innerText=u;const w=document.createElement("span");w.style="font-size: 12px;margin-top: 6px; color: #999;",w.innerText=E,a.appendChild(d),a.appendChild(w);const L=document.createElement("span");L.style="display: flex; align-items: center; justify-content: center; font-size: 20px; color: #999;min-width: 16px;",L.innerText="›",p.appendChild(a),p.appendChild(L),M.appendChild(p)}),document.getElementById("list").appendChild(M),T({rows:x,total:e})})}switch(c){case"#/home":window.removeEventListener("scroll",()=>r(l)),i.innerText="cl-lite",S("cl-main",8192).then(m=>{const g=m.exec("SELECT tc.name, tc.fid, tc.count FROM t_channel tc"),u=document.createDocumentFragment();g[0].values.forEach(O=>{const[h,E,p]=O,a=document.createElement("div");a.onclick=()=>{location.hash=`/list?fid=${E}&title=${h}&total=${p}`};const d=document.createElement("span"),w=document.createElement("span"),L=document.createElement("span");a.style="display: flex; align-items: center; line-height: 22px; position: relative; margin-bottom: 20px;",d.style="letter-spacing: 2px;font-size: 16px;",d.innerText=h,w.style="font-size: 14px;margin-left: 3px;",w.innerText=p,L.style="font-size: 20px; color: #999; position: absolute; right: 0px;",L.innerText="›",a.appendChild(d),a.appendChild(w),a.appendChild(L),u.appendChild(a)});const y=document.getElementById("home");for(;y.firstChild;)y.firstChild.remove();y.appendChild(u)});break;case"#/list":let r=function(m){window.scrollY+window.innerHeight>=document.getElementById("list")?.scrollHeight-20&&m()};window.addEventListener("scroll",()=>r(l)),i.innerText=t.get("title"),_!=s&&(_=s,document.getElementById("list").innerHTML="",S("cl-main",8192).then(m=>{const g=m.exec(`SELECT tc.category_size FROM t_channel tc WHERE fid = ${s}`);S(`cl-category-${s}`,g[0].values[0][0]).then(u=>{l()})}));break;case"#/detail":window.removeEventListener("scroll",()=>r(l));const x=document.getElementById("detail");x.innerHTML="";const M=new URLSearchParams(o.split("?")[1]),T=M.get("title");i.innerText=T;const $=M.get("url"),C=M.get("date");S("cl-main",8192).then(m=>{const g=m.exec(`SELECT tc.detail_size FROM t_channel tc WHERE fid = ${$.split("/")[2]}`);S(`cl-detail-${$.split("/")[2]}`,g[0].values[0][0]).then(u=>{u.exec(`SELECT content FROM t_content tc WHERE url="${$}"`)[0].values.forEach(O=>{const h=`<h3>${T}</h3><span>${C}</span><br><br>${O[0]}`;x.innerHTML=h;const E=/[0-9a-fA-F]{40}/,p="magnet:?xt=urn:btih:",a=h.match(E);if(a&&a[0]){const d=document.createElement("button");d.innerText="复制磁链",d.onclick=()=>{navigator.clipboard.writeText(`${p}${a[0]}`)},x.appendChild(d)}})})});break}}
