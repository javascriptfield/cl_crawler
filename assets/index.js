(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(e){if(e.ep)return;e.ep=!0;const n=t(e);fetch(e.href,n)}})();function I(o,c="pad"){let t=[],s=0;const e={pageNum:0,pageSize:20};function n(m){c=="pad"?t.push(...m):t.unshift(...m)}function i(m){t=[],t=m}function $(){t=[],e.pageNum=0,a()}async function a(){e.pageNum+=1,o.bind(this,e)().then(r=>{e.pageNum==1&&(s=r.total),e.pageNum!=1?n(r.rows):i(r.rows)})}async function v(){await a()}return{list:t,total:s,loadMore:v,reload:$}}function D(o){const{url:c,responseType:t,totalSize:s}=o;return new Promise(e=>{const n=document.getElementById("progress"),i=new XMLHttpRequest;i.responseType=t,i.addEventListener("readystatechange",()=>{i.readyState===i.DONE&&(n.style.display="none",e(i.response))}),i.addEventListener("progress",$=>{const a=document.getElementById("progress");a.style.display="block",a.setAttribute("max",s),a.setAttribute("value",$.loaded)}),i.open("get",c),i.send()})}let P=`https://unpkg.com/cl-lite@${document.title}/`;async function S(o,c){return new Promise((t,s)=>{window[o]?t(window[o]):D({url:`${P}db/${o}.sqlite`,responseType:"arraybuffer",totalSize:c}).then(e=>{const n=()=>{window.SQL?(window[o]=new SQL.Database(new Uint8Array(e)),t(window[o])):setTimeout(()=>{n()},100)};n()})})}let R=`https://unpkg.com/cl-lite@${document.title}/`;const H=50049,F=654690;D({url:`${R}dist/sql-wasm.js`,responseType:"text",totalSize:H}).then(o=>{const c=document.createElement("script");c.innerHTML=o,document.head.appendChild(c),D({url:`${R}dist/sql-wasm.wasm`,responseType:"blob",totalSize:F}).then(t=>{initSqlJs({locateFile:()=>URL.createObjectURL(t)}).then(s=>{window.SQL=s})})});let _;window.addEventListener("load",async function(){location.hash||(location.hash="/home"),await z()});window.addEventListener("hashchange",async function(){await z()});async function z(){const o=window.location.hash,c=o.includes("?")?o.split("?")[0]:o,t=new URLSearchParams(o.split("?")[1]),s=t.get("fid"),e=t.get("count");document.querySelectorAll("section").forEach(r=>{r.style.display=`#/${r.getAttribute("id")}`==c?"block":"none"});const i=document.getElementById("header"),{list:$,loadMore:a,reload:v}=I(m);async function m(){const[r]=arguments,x=[],L=document.createDocumentFragment();return new Promise((b,T)=>{window[`cl-category-${s}`].exec(`SELECT * FROM t_topic tp WHERE url like '%/' || ${s} || '/%' AND post_time NOTNULL ORDER BY post_time DESC LIMIT ${r.pageSize} OFFSET ${(r.pageNum-1)*r.pageSize}`)[0].values.forEach(h=>{const[d,f,M]=h,g=new Date(+`${M}000`),O=`${g.toLocaleDateString()} ${g.toLocaleTimeString()}`;x.push({text:d,url:f,date:O});const u=document.createElement("div");u.style="display: flex; align-items: center; justify-content: space-between;margin-bottom: 20px;",u.onclick=()=>{location.hash=`/detail?date=${O}&title=${d}&url=${f}`};const l=document.createElement("span");l.style="display:flex; flex-direction: column; font-size: 14px;";const y=document.createElement("span");y.style="font-size: 14px;",y.innerText=d;const E=document.createElement("span");E.style="font-size: 12px;margin-top: 6px; color: #999;",E.innerText=O,l.appendChild(y),l.appendChild(E);const w=document.createElement("span");w.style="display: flex; align-items: center; justify-content: center; font-size: 20px; color: #999;min-width: 16px;",w.innerText="›",u.appendChild(l),u.appendChild(w),L.appendChild(u)}),document.getElementById("list").appendChild(L),b({rows:x,total:e})})}switch(c){case"#/home":window.removeEventListener("scroll",()=>r(a)),i.innerText="cl-lite",S("cl-main",8192).then(p=>{const h=p.exec("SELECT tc.name, tc.fid, tc.count FROM t_channel tc"),d=document.createDocumentFragment();h[0].values.forEach(M=>{const[g,O,u]=M,l=document.createElement("div");l.onclick=()=>{location.hash=`/list?fid=${O}&title=${g}&total=${u}`};const y=document.createElement("span"),E=document.createElement("span"),w=document.createElement("span");l.style="display: flex; align-items: center; line-height: 22px; position: relative; margin-bottom: 20px;",y.style="letter-spacing: 2px;font-size: 16px;",y.innerText=g,E.style="font-size: 14px;margin-left: 3px;",E.innerText=u,w.style="font-size: 20px; color: #999; position: absolute; right: 0px;",w.innerText="›",l.appendChild(y),l.appendChild(E),l.appendChild(w),d.appendChild(l)});const f=document.getElementById("home");for(;f.firstChild;)f.firstChild.remove();f.appendChild(d)});break;case"#/list":let r=function(p){window.scrollY+window.innerHeight>=document.getElementById("list")?.scrollHeight-20&&p()};window.addEventListener("scroll",()=>r(a)),i.innerText=t.get("title"),_!=s&&(_=s,document.getElementById("list").innerHTML="",S("cl-main",8192).then(p=>{const h=p.exec(`SELECT tc.category_size FROM t_channel tc WHERE fid = ${s}`);S(`cl-category-${s}`,h[0].values[0][0]).then(d=>{a()})}));break;case"#/detail":window.removeEventListener("scroll",()=>r(a));const x=document.getElementById("detail");x.innerHTML="";const L=new URLSearchParams(o.split("?")[1]),b=L.get("title");i.innerText=b;const T=L.get("url"),C=L.get("date");S("cl-main",8192).then(p=>{const h=p.exec(`SELECT tc.detail_size FROM t_channel tc WHERE fid = ${T.split("/")[2]}`);S(`cl-detail-${T.split("/")[2]}`,h[0].values[0][0]).then(d=>{d.exec(`SELECT content FROM t_content tc WHERE url="${T}"`)[0].values.forEach(M=>{const g=`<h3>${b}</h3><span>${C}</span><br><br>${M[0]}`;x.innerHTML=g})})});break}}
